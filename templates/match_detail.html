<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Match Details</title>
    <style>
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }

      table,
      th,
      td {
        border: 1px solid black;
      }

      th,
      td {
        padding: 10px;
        text-align: left;
      }

      th {
        background-color: #f2f2f2;
      }

      .lineups-container {
        display: flex;
        justify-content: space-between;
      }

      .lineup {
        width: 48%; /* Split the width to show side by side, accounting for some margin */
      }
    </style>
  </head>

  <body>
    <h1>Match Details</h1>
    <table>
      <tr>
        <th>Teams</th>
        <td>
          <a href="{{ url_for('team_detail', team_id=match.homeTeam.id) }}"
            >{{ match.homeTeam.name }}</a
          >
          vs
          <a href="{{ url_for('team_detail', team_id=match.awayTeam.id) }}"
            >{{ match.awayTeam.name }}</a
          >
        </td>
      </tr>
      <tr>
        <th>Score</th>
        <td>{{ match.homeScore.display }} - {{ match.awayScore.display }}</td>
      </tr>
      <tr>
        <th>Status</th>
        <td>{{ match.status.description }}</td>
      </tr>
      <tr>
        <th>Start Time</th>
        <td>
          {{ (match.startTimestamp|float)|datetimeformat('%d/%m/%Y %H:%M') }}
        </td>
      </tr>
      <tr>
        <th>Tournament</th>
        <td>{{ match.tournament.name }}</td>
      </tr>
      <tr>
        <th>Venue</th>
        <td>
          {% if 'venue' in match and 'stadium' in match.venue and 'name' in
          match.venue.stadium %} {{ match.venue.stadium.name }}, {% endif %} {%
          if 'venue' in match and 'city' in match.venue and 'name' in
          match.venue.city %} {{ match.venue.city.name }}, {% endif %} {% if
          'venue' in match and 'country' in match.venue and 'name' in
          match.venue.country %} {{ match.venue.country.name }} {% endif %}
        </td>
      </tr>
      <tr>
        <th>Referee</th>
        <td>
          {% if 'referee' in match and 'name' in match.referee %} {{
          match.referee.name }} {% else %} Not Available {% endif %}
        </td>
      </tr>
    </table>
    <br />
    <a href="{{ url_for('fixtures') }}">Back to Fixtures</a>

    <table>
      <thead>
        <tr>
          <th>Home Team Last 10 Matches</th>
          <th>Result</th>
          <th>Away Team Last 10 Matches</th>
          <th>Result</th>
        </tr>
      </thead>
      <tbody>
        {% for home_match, away_match in zip(home_last_10, away_last_10) %}
        <tr>
          <td>
            {{ home_match.homeTeam.name }} vs {{ home_match.awayTeam.name }}: {{
            home_match.homeScore.current }} - {{ home_match.awayScore.current }}
          </td>
          <td
            style="background-color: 
                        {% if home_match['result'] == 'win' %}green
                        {% elif home_match['result'] == 'loss' %}red
                        {% else %}yellow{% endif %};"
          >
            {{ home_match['result'] }}
          </td>
          <td>
            {{ away_match.homeTeam.name }} vs {{ away_match.awayTeam.name }}: {{
            away_match.homeScore.current }} - {{ away_match.awayScore.current }}
          </td>
          <td
            style="background-color: 
                        {% if away_match['result'] == 'win' %}green
                        {% elif away_match['result'] == 'loss' %}red
                        {% else %}yellow{% endif %};"
          >
            {{ away_match['result'] }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <h2>Team Lineups</h2>
    <div class="lineups-container">
      <!-- Home Team Lineup -->
      <div class="lineup">
        <h3>{{ match.homeTeam.name }} ({{ lineups.home.formation }})</h3>
        <h4>Starting XI</h4>
        <table>
          <thead>
            <tr>
              <th>Jersey Number</th>
              <th>Player Name</th>
              <th>Rating</th>
              <th>Fouls</th>
              <th>Position</th>
              <th>Country</th>
              <th>Substitution</th>
              <th>Goals</th>
              <th>Assists</th>
            </tr>
          </thead>
          <tbody>
            {% for player in lineups.home.players if not player.substitute %}
            <tr>
              <td>{{ player.jerseyNumber }}</td>
              <td>{{ player.player.name }}</td>
              <td>
                {% if 'statistics' in player and 'rating' in player.statistics
                %} {{ player.statistics.rating }} {% else %} - {% endif %}
              </td>
              <td>
                {% if 'statistics' in player and 'fouls' in player.statistics %}
                {{ player.statistics.fouls }} {% else %} - {% endif %}
              </td>
              <td>{{ player.position }}</td>
              <td>{{ player.player.country.name }}</td>
              <!-- Check for substitution status and display it -->
              <!-- Check for substitutions -->
              <td>
                {% if player.player.id in subbed_out %} Out ({{
                subbed_out[player.player.id]['time'] }}') for {{
                subbed_out[player.player.id]['name'] }} {% elif player.player.id
                in subbed_in %} In ({{ subbed_in[player.player.id]['time'] }}')
                for {{ subbed_in[player.player.id]['name'] }} {% else %} - {%
                endif %}
              </td>
              <td>
                {% if player.player.id in goal_scorers %} {% for time in
                goal_scorers[player.player.id] %} âš½ {{ time }}' {% endfor %} {%
                else %} - {% endif %}
              </td>
              <td>
                {% if player.player.id in assists %} ðŸŽ¯ {{
                assists[player.player.id]|join(", ") }}' {% else %} - {% endif
                %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <h4>Substitutes</h4>
        <table>
          <thead>
            <tr>
              <th>Jersey Number</th>
              <th>Player Name</th>
              <th>Rating</th>
              <th>Fouls</th>
              <th>Position</th>
              <th>Country</th>
              <th>Substitution</th>
              <th>Goals</th>
              <th>Assists</th>
            </tr>
          </thead>
          <tbody>
            {% for player in lineups.home.players if player.substitute %}
            <tr>
              <td>{{ player.jerseyNumber }}</td>
              <td>{{ player.player.name }}</td>
              <td>
                {% if 'statistics' in player and 'rating' in player.statistics
                %} {{ player.statistics.rating }} {% else %} - {% endif %}
              </td>
              <td>
                {% if 'statistics' in player and 'fouls' in player.statistics %}
                {{ player.statistics.fouls }} {% else %} - {% endif %}
              </td>
              <td>{{ player.position }}</td>
              <td>{{ player.player.country.name }}</td>
              <!-- Check for substitution status and display it -->
              <!-- Check for substitutions -->
              <td>
                {% if player.player.id in subbed_out %} Out ({{
                subbed_out[player.player.id]['time'] }}') for {{
                subbed_out[player.player.id]['name'] }} {% elif player.player.id
                in subbed_in %} In ({{ subbed_in[player.player.id]['time'] }}')
                for {{ subbed_in[player.player.id]['name'] }} {% else %} - {%
                endif %}
              </td>
              <td>
                {% if player.player.id in goal_scorers %} {% for time in
                goal_scorers[player.player.id] %} âš½ {{ time }}' {% endfor %} {%
                else %} - {% endif %}
              </td>
              <td>
                {% if player.player.id in assists %} ðŸŽ¯ {{
                assists[player.player.id]|join(", ") }}' {% else %} - {% endif
                %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Away Team Lineup -->
      <div class="lineup">
        <h3>{{ match.awayTeam.name }} ({{ lineups.away.formation }})</h3>
        <h4>Starting XI</h4>
        <table>
          <thead>
            <tr>
              <th>Jersey Number</th>
              <th>Player Name</th>
              <th>Rating</th>
              <th>Fouls</th>
              <th>Position</th>
              <th>Country</th>
              <th>Substitution</th>
              <th>Goals</th>
              <th>Assists</th>
            </tr>
          </thead>
          <tbody>
            {% for player in lineups.away.players if not player.substitute %}
            <tr>
              <td>{{ player.jerseyNumber }}</td>
              <td>{{ player.player.name }}</td>
              <td>
                {% if 'statistics' in player and 'rating' in player.statistics
                %} {{ player.statistics.rating }} {% else %} - {% endif %}
              </td>
              <td>
                {% if 'statistics' in player and 'fouls' in player.statistics %}
                {{ player.statistics.fouls }} {% else %} - {% endif %}
              </td>
              <td>{{ player.position }}</td>
              <td>{{ player.player.country.name }}</td>
              <!-- Check for substitution status and display it -->
              <!-- Check for substitutions -->
              <td>
                {% if player.player.id in subbed_out %} Out ({{
                subbed_out[player.player.id]['time'] }}') for {{
                subbed_out[player.player.id]['name'] }} {% elif player.player.id
                in subbed_in %} In ({{ subbed_in[player.player.id]['time'] }}')
                for {{ subbed_in[player.player.id]['name'] }} {% else %} - {%
                endif %}
              </td>
              <td>
                {% if player.player.id in goal_scorers %} {% for time in
                goal_scorers[player.player.id] %} âš½ {{ time }}' {% endfor %} {%
                else %} - {% endif %}
              </td>
              <td>
                {% if player.player.id in assists %} ðŸŽ¯ {{
                assists[player.player.id]|join(", ") }}' {% else %} - {% endif
                %}
              </td>
            </tr>

            {% endfor %}
          </tbody>
        </table>

        <h4>Substitutes</h4>
        <table>
          <thead>
            <tr>
              <th>Jersey Number</th>
              <th>Player Name</th>
              <th>Rating</th>
              <th>Fouls</th>
              <th>Position</th>
              <th>Country</th>
              <th>Substitution</th>
              <th>Goals</th>
              <th>Assists</th>
            </tr>
          </thead>
          <tbody>
            {% for player in lineups.away.players if player.substitute %}
            <tr>
              <td>{{ player.jerseyNumber }}</td>
              <td>{{ player.player.name }}</td>
              <td>
                {% if 'statistics' in player and 'rating' in player.statistics
                %} {{ player.statistics.rating }} {% else %} - {% endif %}
              </td>
              <td>
                {% if 'statistics' in player and 'fouls' in player.statistics %}
                {{ player.statistics.fouls }} {% else %} - {% endif %}
              </td>
              <td>{{ player.position }}</td>
              <td>{{ player.player.country.name }}</td>
              <!-- Check for substitutions -->
              <!-- Check for substitutions -->
              <td>
                {% if player.player.id in subbed_out %} Out ({{
                subbed_out[player.player.id]['time'] }}') for {{
                subbed_out[player.player.id]['name'] }} {% elif player.player.id
                in subbed_in %} In ({{ subbed_in[player.player.id]['time'] }}')
                for {{ subbed_in[player.player.id]['name'] }} {% else %} - {%
                endif %}
              </td>
              <td>
                {% if player.player.id in goal_scorers %} {% for time in
                goal_scorers[player.player.id] %} âš½ {{ time }}' {% endfor %} {%
                else %} - {% endif %}
              </td>
              <td>
                {% if player.player.id in assists %} ðŸŽ¯ {{
                assists[player.player.id]|join(", ") }}' {% else %} - {% endif
                %}
              </td>
            </tr>

            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </body>

  <script>
    const axios = require("axios");

    async function fetchPlayerImage(playerId) {
      const options = {
        method: "GET",
        url: `https://footapi7.p.rapidapi.com/api/player/${playerId}/image`,
        headers: {
          "X-RapidAPI-Key":
            "b42bc11359msh98e3d09a1e9557dp173da4jsn260d881d9ab9",
          "X-RapidAPI-Host": "footapi7.p.rapidapi.com",
        },
      };

      try {
        const response = await axios.request(options);
        return response.data;
      } catch (error) {
        console.error(error);
        return null;
      }
    }
  </script>
</html>
