{% extends 'base.html' %}

{% block title %}Today's Football Fixtures{% endblock %}

{% block content %}
  <div class="space-y-6">
    <h1 class="text-2xl font-semibold tracking-tight">Today's Football Fixtures</h1>

    {% for tournament, events in grouped_events.items() %}
    <section id="{{tournament}}" class="card overflow-hidden">
      <div class="px-4 py-3 border-b border-slate-800/60 flex items-center justify-between">
        <h2 class="text-base font-medium">{{ tournament }}</h2>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-slate-800/40 text-slate-200">
            <tr>
              <th class="px-4 py-2 text-left font-semibold">Home Team</th>
              <th class="px-4 py-2 text-left font-semibold">Away Team</th>
              <th class="px-4 py-2 text-left font-semibold">Score</th>
              <th class="px-4 py-2 text-left font-semibold">Status</th>
              <th class="px-4 py-2 text-left font-semibold">Start Time</th>
              <th class="px-4 py-2 text-left font-semibold">Tournament</th>
              <th class="px-4 py-2 text-left font-semibold">Country</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-800/60">
            {% for event in events %}
            {% if (event.startTimestamp | float) | datetimeformat('%d/%m/%Y') == today.strftime('%d/%m/%Y') %}
            <tr class="hover:bg-slate-800/30">
              <td class="px-4 py-2">{{ event.homeTeam.name }}</td>
              <td class="px-4 py-2">{{ event.awayTeam.name }}</td>
              <td class="px-4 py-2">
                <span class="font-semibold {% if event.status.type == 'finished' %} text-slate-400 {% elif event.status.type == 'inprogress' %} text-rose-400 {% else %} text-slate-200 {% endif %}">
                  {{ event.homeScore.display }} - {{ event.awayScore.display }}
                </span>
              </td>
              <td class="px-4 py-2">
                <a class="accent hover:underline" href="{{ url_for('match_detail', match_id=event.id) }}">{{ event.status.description }}</a>
              </td>
              <td class="px-4 py-2">{{ (event.startTimestamp | float) | datetimeformat('%d/%m/%Y %H:%M') }}</td>
              <td class="px-4 py-2">{{ event.tournament.name }}</td>
              <td class="px-4 py-2">{{ event.tournament.uniqueTournament.category.name }}</td>
            </tr>
            {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
    {% endfor %}
  </div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const tables = document.querySelectorAll("section.card");
    tables.forEach((section) => {
      const hasData = Array.from(section.querySelectorAll("tbody td")).some(
        (td) => td.textContent.trim() !== ""
      );
      if (!hasData) {
        section.style.display = "none";
      }
    });
  });
</script>
{% endblock %}
